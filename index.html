<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Lapor Mangan! - Purwokerto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --red: #c53e4e;
      --light-red: #d8c2cf;
      --bg: #f8f9fa;
      --white: #ffffff;
      --text: #333;
      --blue: #2980b9;
      --green: #27ae60;
      --yellow: #f39c12;
      --shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
    body { background: var(--bg); color: var(--text); }
    header {
      background: linear-gradient(135deg, var(--red), #a52a3a);
      color: var(--white);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      position: relative;
      flex-wrap: wrap;
      box-shadow: var(--shadow);
    }
    .header-content {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 200px;
    }
    header h1 {
        font-size: 1.5rem;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    .weather-info {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      white-space: nowrap;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .weather-info:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    .weather-icon {
      font-size: 20px;
    }
    .weather-temp {
      font-weight: 600;
      font-size: 16px;
    }
    .weather-details {
      position: absolute;
      top: calc(100% + 10px);
      right: 20px;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: var(--shadow);
      z-index: 1000;
      width: 280px;
      display: none;
      color: var(--text);
      border: 1px solid #eee;
    }
    .weather-details.show {
      display: block;
      animation: fadeIn 0.4s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-15px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    #map {
      height: 60vh;
      width: 100%;
      border-bottom: 2px solid var(--light-red);
    }
    .container {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    .filter-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: stretch;
    }
    .filter-bar input,
    .filter-bar select,
    .filter-bar button {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      min-width: 120px;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }
    .filter-bar input:focus,
    .filter-bar select:focus {
      outline: none;
      border-color: var(--red);
      box-shadow: 0 0 0 2px rgba(197, 62, 78, 0.2);
    }
    .filter-bar button {
      background: var(--red);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      border: none;
    }
    .filter-bar button:hover {
      background: #b03545;
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    .filter-bar .add-btn {
      background: var(--green);
    }
    .filter-bar .add-btn:hover {
      background: #219653;
    }
    
    .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .card {
      background: var(--white);
      border-left: 5px solid var(--red);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border-radius: 12px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      border: 1px solid #eee;
    }
    .card:hover { 
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-left-width: 8px;
    }
    .card h3 { 
        color: var(--red); 
        margin-bottom: 8px;
        font-size: 1.2rem;
    }
    .card p {
        margin: 5px 0;
        font-size: 0.9rem;
        color: #555;
    }
    .card small { 
        color: #777; 
        margin-top: auto;
        font-size: 0.8rem;
    }
    .detail-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 9999;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      animation: popupOpen 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes popupOpen {
        from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    .detail-popup img {
      width: 100%;
      border-radius: 10px;
      margin-top: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      cursor: pointer;
      font-size: 24px;
      color: var(--red);
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }
    .close-btn:hover {
        background: #f0f0f0;
    }
    .add-kuliner-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      font-size: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .add-kuliner-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }
    .add-kuliner-modal {
      display: none;
      position: fixed;
      z-index: 10001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px);
    }
    .add-kuliner-modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 25px;
      border: none;
      border-radius: 15px;
      width: 90%;
      max-width: 550px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: modalContentSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes modalContentSlideIn {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .add-kuliner-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }
    .add-kuliner-modal-header h2 {
        margin: 0;
        color: var(--red);
        font-size: 1.5rem;
    }
    .add-kuliner-modal-body {
        display: flex;
        flex-direction: column;
        gap: 18px;
    }
    .add-kuliner-modal-body input,
    .add-kuliner-modal-body select,
    .add-kuliner-modal-body textarea {
        padding: 12px 15px;
        border: 1px solid #ccc;
        border-radius: 10px;
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        transition: border 0.2s;
    }
    .add-kuliner-modal-body input:focus,
    .add-kuliner-modal-body select:focus,
    .add-kuliner-modal-body textarea:focus {
        outline: none;
        border-color: var(--red);
        box-shadow: 0 0 0 2px rgba(197, 62, 78, 0.2);
    }
    .add-kuliner-modal-body textarea {
        min-height: 80px;
        resize: vertical;
    }
    .add-kuliner-modal-footer {
        margin-top: 25px;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }
    .btn-submit, .btn-cancel {
        padding: 12px 22px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.2s ease;
    }
    .btn-submit {
        background-color: var(--red);
        color: white;
    }
    .btn-submit:hover {
        background-color: #b03545;
        transform: translateY(-2px);
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    .btn-cancel {
        background-color: #eee;
        color: #333;
    }
    .btn-cancel:hover {
        background-color: #ddd;
        transform: translateY(-2px);
    }
    .chatbot {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: var(--red);
      color: white;
      border-radius: 50%;
      padding: 18px;
      cursor: pointer;
      z-index: 999;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      border: 2px solid white;
    }
    .chatbot:hover {
      transform: scale(1.1) rotate(10deg);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .chat-popup {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 25px;
      background: white;
      border-radius: 20px;
      width: 320px;
      height: 450px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      overflow: hidden;
      flex-direction: column;
      z-index: 999;
      border: 1px solid #eee;
      animation: chatSlideIn 0.3s ease-out;
    }
    @keyframes chatSlideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .chat-header {
      background: linear-gradient(135deg, #00B900, #009900);
      color: white;
      padding: 15px 20px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-close {
      cursor: pointer;
      font-size: 22px;
      padding: 5px;
      border-radius: 50%;
      transition: background 0.2s;
    }
    .chat-close:hover {
        background: rgba(255,255,255,0.2);
    }
    .chat-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background: #e5ddd5;
      background-image: url('https://web.line.me/static/desktop/2.1.0/img/bg_chat.5f8e3b6.png');
      background-size: cover;
      scroll-behavior: smooth;
    }
    .message {
      margin-bottom: 12px;
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 20px;
      line-height: 1.4;
      word-wrap: break-word;
      position: relative;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    .message-user {
      background: #DCF8C6;
      margin-left: auto;
      margin-right: 5px;
      border-bottom-right-radius: 5px;
    }
    .message-bot {
      background: white;
      margin-right: auto;
      margin-left: 5px;
      border-bottom-left-radius: 5px;
    }
    .message-time {
      font-size: 10px;
      color: #888;
      margin-top: 5px;
      text-align: right;
    }
    .chat-input-container {
      display: flex;
      padding: 12px;
      background: white;
      border-top: 1px solid #ddd;
    }
    .chat-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 25px;
      outline: none;
      font-size: 0.95rem;
      transition: border 0.2s;
    }
    .chat-input:focus {
        border-color: var(--green);
    }
    .chat-send {
      background: var(--green);
      color: white;
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      margin-left: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .chat-send:hover {
        background: #219653;
        transform: scale(1.05);
    }
    .modal-iframe {
      width: 90%;
      max-width: 800px;
      height: 80vh;
      margin: 5% auto;
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    .modal-iframe-content {
      width: 100%;
      height: 100%;
      border: none;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      backdrop-filter: blur(5px);
      animation: modalFadeIn 0.3s ease-out;
    }
    @keyframes modalFadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .clock {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(5px);
      white-space: nowrap;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .not-found {
        text-align: center;
        padding: 40px 20px;
        color: #777;
    }
    .not-found i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: #ccc;
    }
    .loading {
        text-align: center;
        padding: 20px;
        color: var(--red);
    }
    .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--red);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .marker-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        width: 40px !important;
        height: 40px !important;
        margin-left: -20px !important;
        margin-top: -20px !important;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        border: 2px solid white;
    }
    .marker-icon.bounce {
        animation: bounce 1.2s ease-in-out infinite;
    }
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-12px);
        }
        60% {
            transform: translateY(-6px);
        }
    }
    .marker-icon.shake {
        animation: shake 0.9s ease-in-out infinite;
    }
    @keyframes shake {
        0%, 100% {
            transform: translateX(0);
        }
        10%, 30%, 50%, 70%, 90% {
            transform: translateX(-3px);
        }
        20%, 40%, 60%, 80% {
            transform: translateX(3px);
        }
    }
    @media (max-width: 768px) {
      .filter-bar {
        flex-direction: column;
      }
      .filter-bar input,
      .filter-bar select,
      .filter-bar button {
        width: 100%;
      }
      .chat-popup {
        width: calc(100% - 40px);
        right: 20px;
        left: 20px;
        bottom: 90px;
      }
      header {
          padding: 12px 15px;
      }
      .header-content h1 {
          font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>üçΩ Lapor Mangan! - Purwokerto</h1>
    </div>
    <div class="clock" id="clock">
      <i class="fas fa-clock"></i>
      <span id="clockTime">--:--</span>
    </div>
    <div class="weather-info" id="weatherInfo" onclick="toggleWeatherDetails()">
      <i class="fas fa-cloud-sun weather-icon" id="weatherIcon"></i>
      <span class="weather-temp" id="weatherTemp">--¬∞C</span>
    </div>
    <button class="add-kuliner-btn" onclick="openAddKulinerModal()" title="Tambah Kuliner Baru">+</button>
    <div class="weather-details" id="weatherDetails">
      <div class="weather-details-header">
        <h3>Cuaca Purwokerto</h3>
        <small id="weatherDate">Hari ini</small>
      </div>
      <div class="weather-details-main">
        <i class="fas fa-cloud-sun weather-details-icon" id="weatherDetailsIcon"></i>
        <div>
          <div class="weather-details-temp" id="weatherDetailsTemp">--¬∞C</div>
          <div class="weather-details-desc" id="weatherDetailsDesc">--</div>
        </div>
      </div>
      <div class="weather-details-stats">
        <div class="weather-stat">
          <i class="fas fa-temperature-low"></i>
          <span>Min: <span id="weatherMinTemp">--¬∞C</span></span>
        </div>
        <div class="weather-stat">
          <i class="fas fa-temperature-high"></i>
          <span>Max: <span id="weatherMaxTemp">--¬∞C</span></span>
        </div>
        <div class="weather-stat">
          <i class="fas fa-tint"></i>
          <span>Kelembapan: <span id="weatherHumidity">--%</span></span>
        </div>
        <div class="weather-stat">
          <i class="fas fa-wind"></i>
          <span>Angin: <span id="weatherWind">-- m/s</span></span>
        </div>
        <div class="weather-stat">
          <i class="fas fa-sun"></i>
          <span>Terbit: <span id="weatherSunrise">--:--</span></span>
        </div>
        <div class="weather-stat">
          <i class="fas fa-moon"></i>
          <span>Terbenam: <span id="weatherSunset">--:--</span></span>
        </div>
         <div class="weather-stat">
          <i class="fas fa-cloud-rain"></i>
          <span>Kondisi: <span id="weatherCondition">--</span></span>
        </div>
      </div>
    </div>
  </header>
  <div id="map"></div>
  <div class="container">
    <div class="filter-bar">
      <input id="search" placeholder="üîç Cari nama kuliner..." />
      <select id="filter">
        <option value=""> Semua Kategori</option>
      </select>
      <select id="sort">
        <option value="">Urutkan</option>
        <option value="nama">Nama A-Z</option>
        <option value="harga-asc">Harga Terendah</option>
        <option value="harga-desc">Harga Tertinggi</option>
      </select>
      <button id="weatherRecBtn" type="button"><i class="fas fa-cloud-sun"></i> Rekomendasi Cuaca</button>
      <button id="googleFormBtn" type="button"><i class="fas fa-clipboard-list"></i> Tambah Informasi</button>
    </div>
    <div id="list">
        <div class="loading">
            <div class="spinner"></div>
            <p>Memuat daftar kuliner...</p>
        </div>
    </div>
  </div>
  <div class="detail-popup" id="detailPopup">
    <span class="close-btn" onclick="closeDetail()">√ó</span>
    <div id="detailContent"></div>
  </div>
  <div id="googleFormModal" class="modal">
    <div class="modal-iframe">
      <span class="close-btn" onclick="closeGoogleForm()" style="position: absolute; right: 15px; top: 15px; z-index: 10001; background:white; padding: 5px 10px;">&times;</span>
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScJ8tkZau-NVdhbmd0cWFKY25VBm0Ajjxvqo-rLYAO_iGb2qg/viewform?embedded=true" class="modal-iframe-content"></iframe>
    </div>
  </div>
  <div class="chatbot" onclick="toggleChat()" title="Buka Chatbot MakanBot">üí¨</div>
  <div class="chat-popup" id="chatPopup">
    <div class="chat-header">
      <span>ü§ñ MakanBot</span>
      <span class="chat-close" onclick="toggleChat()">√ó</span>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message message-bot">
        <span>Halo! Aku MakanBot üçΩ Mau cari kuliner apa di Purwokerto hari ini?</span>
        <div class="message-time">Baru saja</div>
      </div>
    </div>
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Ketik pesan..." onkeypress="if(event.key=='Enter') sendChat()">
      <button class="chat-send" onclick="sendChat()" title="Kirim Pesan">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 2L11 13" stroke="white" stroke-width="2"/>
          <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2"/>
        </svg>
      </button>
    </div>
  </div>
  <div id="addKulinerModal" class="add-kuliner-modal">
    <div class="add-kuliner-modal-content">
      <div class="add-kuliner-modal-header">
        <h2>‚ûï Tambah Kuliner Baru</h2>
        <span class="close-btn" onclick="closeAddKulinerModal()">&times;</span>
      </div>
      <div class="add-kuliner-modal-body">
        <input type="text" id="add-nama" placeholder="Nama Kuliner *" required>
        <select id="add-kategori" required>
          <option value="">Pilih Kategori *</option>
        </select>
        <input type="text" id="add-alamat" placeholder="Alamat *" required>
        <input type="text" id="add-jam" placeholder="Jam Operasional (contoh: 08:00 - 18:00) *" required>
        <input type="text" id="add-harga" placeholder="Harga (contoh: Rp 5.000 - 15.000) *" required>
        <textarea id="add-deskripsi" placeholder="Deskripsi *" required></textarea>
        <input type="text" id="add-foto" placeholder="URL Foto (opsional)">
        <select id="add-tipe">
            <option value="false">Warung/Toko Tetap</option>
            <option value="true">Pedagang Keliling</option>
        </select>
        <input type="number" id="add-lat" placeholder="Latitude (contoh: -7.4100) *" step="any" required>
        <input type="number" id="add-lng" placeholder="Longitude (contoh: 109.2450) *" step="any" required>
        <input type="text" id="add-rute" placeholder="Rute/Info Lokasi Tambahan (opsional)">
        <input type="text" id="add-parkir" placeholder="Info Parkir (contoh: Ya, Tidak, Tersedia) *" required>
      </div>
      <div class="add-kuliner-modal-footer">
        <button type="button" class="btn-cancel" onclick="closeAddKulinerModal()"><i class="fas fa-times"></i> Batal</button>
        <button type="button" class="btn-submit" onclick="submitNewKuliner()"><i class="fas fa-plus"></i> Tambah</button>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const GOOGLE_MAPS_API_KEY = 'AIzaSyCYJfw26FLV4doHPdXu9O5fyqoQXgcTveM';
    const kulinerData = [
      {
        nama: "Soto Sokaraja",
        kategori: "Soto",
        alamat: "Jl. Jend. Sudirman No.58, Purwokerto",
        jam: "07:00 - 15:00",
        harga: "Rp15.000-Rp20.000",
        deskripsi: "Kuah kental dengan irisan daging sapi, khas Sokaraja yang legendaris.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Tersedia",
        rute: "Area Sokaraja",
        lat: -7.421,
        lng: 109.242,
        keliling: false
      },
      {
        nama: "Sate Bebek Tambak",
        kategori: "Sate",
        alamat: "Jl. Tambak, Purwokerto",
        jam: "16:00 - 22:00",
        harga: "Rp25.000-Rp40.000",
        deskripsi: "Sate bebek gurih dengan bumbu kacang dan arang khas, favorit malam hari.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Tersedia",
        rute: "Jl. Tambak",
        lat: -7.423,
        lng: 109.240,
        keliling: false
      },
      {
        nama: "Tempe Mendoan",
        kategori: "Jajanan Tradisional",
        alamat: "Pasar Sokaraja, Purwokerto",
        jam: "06:00 - 18:00",
        harga: "Rp2.000-Rp5.000",
        deskripsi: "Tempe tipis digoreng renyah, disajikan dengan sambal kecap pedas.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Tersedia",
        rute: "Pasar Sokaraja",
        lat: -7.420,
        lng: 109.230,
        keliling: true
      },
      {
        nama: "Nasi Liwet Mbah Maimun",
        kategori: "Makanan Berat",
        alamat: "Jl. Pahlawan No.123, Purwokerto",
        jam: "16:00 - 22:00",
        harga: "Rp18.000-Rp25.000",
        deskripsi: "Nasi gurih santan dengan lauk ayam suwir, telur, dan tempe orek.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Tersedia",
        rute: "Jl. Pahlawan No.123",
        lat: -7.425,
        lng: 109.250,
        keliling: false
      },
      {
        nama: "Bakso President",
        kategori: "Bakso",
        alamat: "Jl. Dr. Angka No.88, Purwokerto",
        jam: "08:00 - 21:00",
        harga: "Rp15.000-Rp25.000",
        deskripsi: "Bakso besar dengan kuah gurih dan tekstur kenyal, ikonik di Purwokerto.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Ya",
        rute: "Jl. Dr. Angka No.88",
        lat: -7.418,
        lng: 109.245,
        keliling: false
      },
      {
        nama: "Gudeg Mbah Siti",
        kategori: "Gudeg",
        alamat: "Jl. Slamet Riyadi No.45, Purwokerto",
        jam: "09:00 - 19:00",
        harga: "Rp20.000-Rp30.000",
        deskripsi: "Gudeg manis khas Jawa dengan krengsengan ayam dan nangka muda.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Ya",
        rute: "Jl. Slamet Riyadi No.45",
        lat: -7.430,
        lng: 109.235,
        keliling: false
      },
      {
        nama: "Ayam Bakar Pak Tono",
        kategori: "Ayam",
        alamat: "Jl. Diponegoro No.78, Purwokerto",
        jam: "11:00 - 23:00",
        harga: "Rp25.000-Rp40.000",
        deskripsi: "Ayam bakar bumbu rempah, disajikan dengan sambal matah dan lalapan.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Ya",
        rute: "Jl. Diponegoro No.78",
        lat: -7.422,
        lng: 109.248,
        keliling: false
      },
      {
        nama: "Lontong Sayur Mbah Rini",
        kategori: "Lontong",
        alamat: "Jl. Ahmad Yani No.90, Purwokerto",
        jam: "07:00 - 14:00",
        harga: "Rp12.000-Rp18.000",
        deskripsi: "Lontong dengan sayur labu siam santan, tahu, dan telur.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Ya",
        rute: "Jl. Ahmad Yani No.90",
        lat: -7.415,
        lng: 109.240,
        keliling: false
      },
      {
        nama: "Sate Kere Mbah Haji",
        kategori: "Sate",
        alamat: "Jl. Raden Intan No.67, Purwokerto",
        jam: "10:00 - 20:00",
        harga: "Rp10.000-Rp15.000",
        deskripsi: "Sate kambing murah meriah dengan bumbu kacang dan kecap.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Ya",
        rute: "Jl. Raden Intan No.67",
        lat: -7.428,
        lng: 109.255,
        keliling: false
      },
      {
        nama: "Bakso Mbah Lintang",
        kategori: "Bakso",
        alamat: "Jl. KH. Mas Mansyur No.34, Purwokerto",
        jam: "08:00 - 17:00",
        harga: "Rp8.000-Rp15.000",
        deskripsi: "Bakso urat besar dengan kuah kaldu sapi yang sangat gurih.",
        foto: "https://i.imgur.com/8z3L5kL.jpg",
        parkir: "Ya",
        rute: "Jl. KH. Mas Mansyur No.34",
        lat: -7.420,
        lng: 109.238,
        keliling: false
      }
    ];

    let map;
    let markers = [];
    let currentWeatherData = null;

    // Inisialisasi DOM
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded - initializing app');
        initializeApp();
    });

    function initializeApp() {
        populateCategoryDropdowns();
        initMap();
        renderList();
        updateClock();
        setInterval(updateClock, 60000);
        fetchWeather();
        setupEventListeners();
    }

    function setupEventListeners() {
        // Tombol Weather Recommendation
        const weatherBtn = document.getElementById('weatherRecBtn');
        if (weatherBtn) {
            weatherBtn.addEventListener('click', showWeatherRec);
        }

        // Tombol Google Form
        const googleFormBtn = document.getElementById('googleFormBtn');
        if (googleFormBtn) {
            googleFormBtn.addEventListener('click', openGoogleForm);
        }

        // Tombol Tambah Kuliner
        const addBtn = document.querySelector('.add-kuliner-btn');
        if (addBtn) {
            addBtn.addEventListener('click', openAddKulinerModal);
        }

        // Event listener untuk search dan filter
        const searchInput = document.getElementById('search');
        const filterSelect = document.getElementById('filter');
        const sortSelect = document.getElementById('sort');
        
        if (searchInput) searchInput.addEventListener('input', filterAndSortList);
        if (filterSelect) filterSelect.addEventListener('change', filterAndSortList);
        if (sortSelect) sortSelect.addEventListener('change', filterAndSortList);

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            const weatherDetails = document.getElementById('weatherDetails');
            if (weatherDetails && weatherDetails.classList.contains('show') && !e.target.closest('#weatherInfo')) {
                weatherDetails.classList.remove('show');
            }
        });
    }

    function populateCategoryDropdowns() {
        const uniqueCategories = [...new Set(kulinerData.map(item => item.kategori))];
        const filterSelect = document.getElementById('filter');
        const addKategoriSelect = document.getElementById('add-kategori');
        
        if (filterSelect) {
            filterSelect.innerHTML = '<option value=""> Semua Kategori</option>';
            uniqueCategories.sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filterSelect.appendChild(option);
            });
        }
        
        if (addKategoriSelect) {
            addKategoriSelect.innerHTML = '<option value="">Pilih Kategori *</option>';
            uniqueCategories.sort().forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                addKategoriSelect.appendChild(option);
            });
        }
    }

    function initMap() {
        try {
            map = L.map('map').setView([-7.4212, 109.2422], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            renderMap();
        } catch (error) {
            console.error('Error initializing map:', error);
        }
    }

    function renderMap() {
        try {
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            kulinerData.forEach((item, index) => {
                const iconEmoji = item.keliling ? 'üöö' : 'üè†';
                let animationClass = '';
                if (item.keliling) {
                    animationClass = Math.random() > 0.5 ? 'bounce' : 'shake';
                }
                const marker = L.marker([item.lat, item.lng], {
                    icon: L.divIcon({
                        html: `<div class="marker-icon ${animationClass}">${iconEmoji}</div>`,
                        className: '',
                        iconSize: [40, 40]
                    })
                }).addTo(map)
                  .bindPopup(`<b>${item.nama}</b><br>${item.kategori}<br>${item.alamat}`)
                  .on('click', () => showDetail(index));
                markers.push(marker);
            });
        } catch (error) {
            console.error('Error rendering map:', error);
        }
    }

    function filterAndSortList() {
        const searchTerm = document.getElementById('search')?.value || '';
        const category = document.getElementById('filter')?.value || '';
        const sortOption = document.getElementById('sort')?.value || '';
        renderList(searchTerm, category, sortOption);
    }

    function renderList(search = "", category = "", sortOption = "") {
        const list = document.getElementById("list");
        if (!list) return;
        
        list.innerHTML = '<div class="loading"><div class="spinner"></div><p>Memuat daftar kuliner...</p></div>';
        
        setTimeout(() => {
            list.innerHTML = "";
            let filteredData = kulinerData.filter(d =>
                d.nama.toLowerCase().includes(search.toLowerCase()) &&
                (category === "" || d.kategori === category)
            );
            
            if (sortOption === "nama") {
                filteredData.sort((a, b) => a.nama.localeCompare(b.nama, 'id'));
            } else if (sortOption === "harga-asc" || sortOption === "harga-desc") {
                filteredData.sort((a, b) => {
                    const priceA = parseFloat(a.harga.replace(/[^0-9,-]/g, '').split('-')[0]) || 0;
                    const priceB = parseFloat(b.harga.replace(/[^0-9,-]/g, '').split('-')[0]) || 0;
                    return sortOption === "harga-asc" ? priceA - priceB : priceB - priceA;
                });
            }
            
            if (filteredData.length === 0) {
                list.innerHTML = `
                    <div class="not-found">
                        <i class="fas fa-utensils"></i>
                        <h3>Oops! Tidak ada hasil ditemukan</h3>
                        <p>Coba kata kunci atau kategori yang berbeda.</p>
                    </div>
                `;
                return;
            }
            
            const cardContainer = document.createElement('div');
            cardContainer.className = 'card-container';
            
            filteredData.forEach((d, i) => {
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `
                  <h3>${d.nama}</h3>
                  <p><i class="fas fa-tag"></i> ${d.kategori}</p>
                  <p><i class="fas fa-map-marker-alt"></i> ${d.alamat}</p>
                  <small><i class="fas fa-clock"></i> ${d.jam} ‚Ä¢ <i class="fas fa-money-bill-wave"></i> ${d.harga}</small>
                `;
                div.onclick = () => showDetail(kulinerData.indexOf(d));
                cardContainer.appendChild(div);
            });
            
            list.appendChild(cardContainer);
        }, 300);
    }

    function showDetail(index) {
        try {
            const item = kulinerData[index];
            const content = `
                <h3>${item.nama}</h3>
                <p><strong><i class="fas fa-tag"></i> Kategori:</strong> ${item.kategori}</p>
                <p><strong><i class="fas fa-map-marker-alt"></i> Alamat:</strong> ${item.alamat}</p>
                <p><strong><i class="fas fa-clock"></i> Jam Operasional:</strong> ${item.jam}</p>
                <p><strong><i class="fas fa-money-bill-wave"></i> Harga:</strong> ${item.harga}</p>
                <p><strong><i class="fas fa-align-left"></i> Deskripsi:</strong> ${item.deskripsi}</p>
                <p><strong><i class="fas fa-parking"></i> Parkir:</strong> ${item.parkir}</p>
                <p><strong><i class="fas fa-route"></i> Rute:</strong> ${item.rute}</p>
                <p><strong><i class="fas fa-store"></i> Tipe:</strong> ${item.keliling ? 'Pedagang Keliling üöö' : 'Warung/Toko Tetap üè†'}</p>
                <img src="${item.foto}" alt="${item.nama}" onerror="this.src='https://via.placeholder.com/400x200?text=Gambar+Tidak+Tersedia';">
                <button onclick="openGoogleMaps(${item.lat}, ${item.lng})" style="margin-top: 10px; padding: 8px 16px; background: var(--blue); color: white; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-map"></i> Buka di Google Maps
                </button>
            `;
            const popup = document.getElementById("detailPopup");
            if (popup) {
                document.getElementById("detailContent").innerHTML = content;
                popup.style.display = 'block';
            }
            if (map) {
                map.setView([item.lat, item.lng], 16);
            }
        } catch (error) {
            console.error('Error showing detail:', error);
        }
    }

    function closeDetail() {
        const popup = document.getElementById('detailPopup');
        if (popup) popup.style.display = 'none';
    }

    function openGoogleForm() {
        try {
            const modal = document.getElementById('googleFormModal');
            if (modal) {
                modal.style.display = 'block';
            } else {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLScJ8tkZau-NVdhbmd0cWFKY25VBm0Ajjxvqo-rLYAO_iGb2qg/viewform', '_blank');
            }
        } catch (error) {
            console.error('Error opening Google Form:', error);
            window.open('https://docs.google.com/forms/d/e/1FAIpQLScJ8tkZau-NVdhbmd0cWFKY25VBm0Ajjxvqo-rLYAO_iGb2qg/viewform', '_blank');
        }
    }

    function closeGoogleForm() {
        const modal = document.getElementById('googleFormModal');
        if (modal) modal.style.display = 'none';
    }

    function openAddKulinerModal() {
        const modal = document.getElementById('addKulinerModal');
        if (modal) modal.style.display = 'block';
    }

    function closeAddKulinerModal() {
        const modal = document.getElementById('addKulinerModal');
        if (modal) {
            modal.style.display = 'none';
            // Reset form
            const inputs = modal.querySelectorAll('input, select, textarea');
            inputs.forEach(input => input.value = '');
        }
    }

    function submitNewKuliner() {
        try {
            const formData = {
                nama: document.getElementById('add-nama')?.value?.trim() || '',
                kategori: document.getElementById('add-kategori')?.value || '',
                alamat: document.getElementById('add-alamat')?.value?.trim() || '',
                jam: document.getElementById('add-jam')?.value?.trim() || '',
                harga: document.getElementById('add-harga')?.value?.trim() || '',
                deskripsi: document.getElementById('add-deskripsi')?.value?.trim() || '',
                foto: document.getElementById('add-foto')?.value?.trim() || 'https://i.imgur.com/8z3L5kL.jpg',
                parkir: document.getElementById('add-parkir')?.value?.trim() || '',
                rute: document.getElementById('add-rute')?.value?.trim() || "Tidak disebutkan",
                lat: parseFloat(document.getElementById('add-lat')?.value) || 0,
                lng: parseFloat(document.getElementById('add-lng')?.value) || 0,
                keliling: document.getElementById('add-tipe')?.value === 'true'
            };

            if (!formData.nama || !formData.kategori || !formData.alamat || !formData.lat || !formData.lng) {
                alert('Harap isi semua field yang wajib (bertanda *)');
                return;
            }

            kulinerData.push(formData);
            renderMap();
            populateCategoryDropdowns();
            filterAndSortList();
            closeAddKulinerModal();
            alert('Kuliner baru berhasil ditambahkan!');
        } catch (error) {
            console.error('Error submitting new kuliner:', error);
            alert('Terjadi kesalahan saat menambahkan kuliner');
        }
    }

    function toggleChat() {
        const chat = document.getElementById("chatPopup");
        if (chat) {
            const isVisible = chat.style.display === "flex";
            chat.style.display = isVisible ? "none" : "flex";
            if (!isVisible) {
                const input = document.getElementById("chatInput");
                if (input) input.focus();
            }
        }
    }

    function sendChat() {
        try {
            const input = document.getElementById("chatInput");
            const chatMessages = document.getElementById("chatMessages");
            if (!input || !chatMessages) return;

            const message = input.value.trim();
            if (!message) return;

            const now = new Date();
            const timeString = now.getHours() + ':' + String(now.getMinutes()).padStart(2, '0');

            // User message
            chatMessages.innerHTML += `
                <div class="message message-user">
                    ${message}
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Show typing
            const typing = document.createElement('div');
            typing.className = 'message message-bot typing-indicator';
            typing.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
            chatMessages.appendChild(typing);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Generate response
            setTimeout(() => {
                if (chatMessages.contains(typing)) {
                    chatMessages.removeChild(typing);
                }
                
                const reply = generateResponse(message);
                chatMessages.innerHTML += `
                    <div class="message message-bot">
                        ${reply}
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        } catch (error) {
            console.error('Error sending chat:', error);
        }
    }

    function generateResponse(input) {
        const text = input.toLowerCase();
        if (text.includes('rekomendasi') || text.includes('sarankan') || text.includes('cuaca')) {
            if (currentWeatherData) {
                return getWeatherBasedRecommendation(currentWeatherData);
            } else {
                return "Maaf, data cuaca belum tersedia. Coba lagi nanti ya!";
            }
        } else if (text.includes('soto')) {
            const soto = kulinerData.find(k => k.kategori === "Soto");
            if (soto) {
                return `üçú ${soto.nama} di ${soto.alamat}, buka ${soto.jam}, harga ${soto.harga}. ${soto.deskripsi}!`;
            }
        } else if (text.includes('mendoan')) {
            const mendoan = kulinerData.find(k => k.nama.includes("Mendoan"));
            if (mendoan) {
                return `ü•¢ ${mendoan.nama} di ${mendoan.alamat}, hanya ${mendoan.harga}. ${mendoan.deskripsi}!`;
            }
        } else if (text.includes('lapar')) {
            return "üçõ Kak lapar? Coba Soto Sokaraja atau Tempe Mendoan. Keduanya mengenyangkan!";
        } else if (text.includes('haus')) {
            return "ü•§ Kak haus? Di Purwokerto banyak minuman segar mulai dari Rp 5.000!";
        } else if (text.includes('terima kasih') || text.includes('makasih')) {
            return "üòä Sama-sama! Semoga harimu menyenangkan dan perut selalu kenyang!";
        } else if (text.includes('halo') || text.includes('hai') || text.includes('hello')) {
            return "üëã Hai juga! Aku MakanBot, siap membantumu menemukan kuliner terbaik di Purwokerto!";
        }
        
        return "ü§ó Aku bisa bantu cari kuliner berdasarkan nama, kategori, atau mood Kak! Coba tanya 'rekomendasi berdasarkan cuaca' atau sebut nama makanan tertentu.";
    }

    function toggleWeatherDetails() {
        const details = document.getElementById("weatherDetails");
        if (details) details.classList.toggle("show");
    }

    function showWeatherRec() {
        try {
            toggleChat();
            const chatMessages = document.getElementById("chatMessages");
            if (!chatMessages) return;

            const now = new Date();
            const timeString = now.getHours() + ':' + String(now.getMinutes()).padStart(2, '0');

            // Tambahkan pesan user
            chatMessages.innerHTML += `
                <div class="message message-user">
                    Rekomendasi Cuaca
                    <div class="message-time">${timeString}</div>
                </div>
            `;

            // Show typing
            const typing = document.createElement('div');
            typing.className = 'message message-bot typing-indicator';
            typing.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
            chatMessages.appendChild(typing);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Generate response
            setTimeout(() => {
                if (chatMessages.contains(typing)) {
                    chatMessages.removeChild(typing);
                }
                
                const reply = getWeatherBasedRecommendation(currentWeatherData) || 
                             "Maaf, rekomendasi cuaca tidak tersedia saat ini.";
                
                chatMessages.innerHTML += `
                    <div class="message message-bot">
                        ${reply}
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1500);
            
        } catch (error) {
            console.error('Error in showWeatherRec:', error);
        }
    }

    function getWeatherBasedRecommendation(weatherData) {
        if (!weatherData) {
            return "Maaf, data cuaca tidak tersedia saat ini.";
        }
        
        const isDay = new Date().getHours() >= 6 && new Date().getHours() < 18;
        const temp = weatherData.main?.temp || 28;
        const condition = weatherData.weather?.[0]?.main?.toLowerCase() || 'clear';
        
        let recommendation = "";
        let recommendedItems = [];

        if (isDay) {
            if (condition.includes('rain')) {
                recommendation = "üåß Hujan-hujan gini, enaknya makan yang hangat aja. Coba deh:";
                recommendedItems = kulinerData.filter(item =>
                    (item.kategori === "Soto" || item.kategori === "Makanan Berat") &&
                    !item.keliling
                );
            } else if (temp > 28) {
                recommendation = "üî• Wah, panasnya! Mendingan minum yang segar dulu. Coba nih:";
                recommendedItems = kulinerData.filter(item =>
                    item.kategori === "Minuman" || item.nama.toLowerCase().includes("es")
                );
            } else {
                recommendation = "‚òÄÔ∏è Cuaca siang ini enak banget! Mau coba yang hangat atau yang dingin? Ini rekomendasinya:";
                recommendedItems = kulinerData.slice(0, 5);
            }
        } else {
            recommendation = "üåô Malam-malam enaknya makan yang hangat. Coba deh:";
            recommendedItems = kulinerData.filter(item =>
                (item.kategori === "Soto" || item.kategori === "Makanan Berat" || item.kategori === "Sate") &&
                !item.keliling
            );
        }

        if (recommendedItems.length > 0) {
            const itemCount = Math.min(2, recommendedItems.length);
            const selectedItems = [];
            const usedIndices = new Set();
            while (selectedItems.length < itemCount && usedIndices.size < recommendedItems.length) {
                const randomIndex = Math.floor(Math.random() * recommendedItems.length);
                if (!usedIndices.has(randomIndex)) {
                    selectedItems.push(recommendedItems[randomIndex]);
                    usedIndices.add(randomIndex);
                }
            }
            let itemText = "";
            selectedItems.forEach(item => {
                itemText += `<br>üçΩ <b>${item.nama}</b> (${item.kategori}) di ${item.alamat}. Harga ${item.harga}`;
            });
            return `${recommendation}${itemText}`;
        } else {
            return "üçΩ Banyak pilihan kuliner enak di Purwokerto! Coba jelajahi peta kami.";
        }
    }

    function openGoogleMaps(lat, lng) {
        const url = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
        window.open(url, '_blank');
    }

    async function fetchWeather() {
        try {
            const API_KEY = '80fa2675a270d693f2a2ac21865a6eba';
            const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Purwokerto,id&appid=${API_KEY}&units=metric&lang=id`);
            if (!response.ok) throw new Error('Gagal mengambil data cuaca');
            const data = await response.json();
            currentWeatherData = data;
            
            document.getElementById("weatherTemp").textContent = `${Math.round(data.main.temp)}¬∞C`;
            document.getElementById("weatherDetailsTemp").textContent = `${Math.round(data.main.temp)}¬∞C`;
            document.getElementById("weatherMinTemp").textContent = `${Math.round(data.main.temp_min)}¬∞C`;
            document.getElementById("weatherMaxTemp").textContent = `${Math.round(data.main.temp_max)}¬∞C`;
            document.getElementById("weatherHumidity").textContent = `${data.main.humidity}%`;
            document.getElementById("weatherWind").textContent = `${data.wind.speed} m/s`;
            document.getElementById("weatherDetailsDesc").textContent = data.weather[0].description;
            document.getElementById("weatherCondition").textContent = data.weather[0].main;
            
            const iconCode = data.weather[0].icon;
            const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
            document.getElementById("weatherIcon").outerHTML = `<img src="${iconUrl}" class="weather-icon" style="width:22px;height:22px;">`;
            document.getElementById("weatherDetailsIcon").outerHTML = `<img src="${iconUrl}" class="weather-details-icon" style="width:45px;height:45px;">`;
            
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById("weatherDate").textContent = today.toLocaleDateString('id-ID', options);
            
            const sunrise = new Date(data.sys.sunrise * 1000);
            const sunset = new Date(data.sys.sunset * 1000);
            const formatTime = (date) => {
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${hours}:${minutes}`;
            };
            document.getElementById("weatherSunrise").textContent = formatTime(sunrise);
            document.getElementById("weatherSunset").textContent = formatTime(sunset);
            
        } catch (error) {
            console.error('Error fetching weather:', error);
            simulateWeather();
        }
    }

    function simulateWeather() {
        const weatherData = {
            main: { temp: 28, temp_min: 22, temp_max: 32, humidity: 75 },
            wind: { speed: 2.5 },
            weather: [{ main: "Clouds", description: "Berawan", icon: "04d" }],
            sys: { sunrise: new Date().setHours(6, 0, 0, 0) / 1000, sunset: new Date().setHours(18, 0, 0, 0) / 1000 }
        };
        currentWeatherData = weatherData;
        
        document.getElementById("weatherTemp").textContent = `${weatherData.main.temp}¬∞C`;
        document.getElementById("weatherDetailsTemp").textContent = `${weatherData.main.temp}¬∞C`;
        document.getElementById("weatherMinTemp").textContent = `${weatherData.main.temp_min}¬∞C`;
        document.getElementById("weatherMaxTemp").textContent = `${weatherData.main.temp_max}¬∞C`;
        document.getElementById("weatherHumidity").textContent = `${weatherData.main.humidity}%`;
        document.getElementById("weatherWind").textContent = `${weatherData.wind.speed} m/s`;
        document.getElementById("weatherDetailsDesc").textContent = weatherData.weather[0].description;
        document.getElementById("weatherCondition").textContent = weatherData.weather[0].main;
        
        document.getElementById("weatherIcon").className = "fas fa-cloud-sun weather-icon";
        document.getElementById("weatherDetailsIcon").className = "fas fa-cloud-sun weather-details-icon";
        
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById("weatherDate").textContent = today.toLocaleDateString('id-ID', options);
        
        const sunrise = new Date(weatherData.sys.sunrise * 1000);
        const sunset = new Date(weatherData.sys.sunset * 1000);
        const formatTime = (date) => {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        };
        document.getElementById("weatherSunrise").textContent = formatTime(sunrise);
        document.getElementById("weatherSunset").textContent = formatTime(sunset);
    }

    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const clockTime = document.getElementById('clockTime');
        if (clockTime) clockTime.textContent = `${hours}:${minutes}`;
    }
  </script>
</body>
</html>
